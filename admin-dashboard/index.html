<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyspack Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        .main-content {
            transition: margin-left 0.3s ease-in-out;
        }
        .main-content.expanded {
            margin-left: 0;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Polyspack Admin</h1>
                <p class="text-gray-600">Login to your dashboard</p>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="loginPassword" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit" id="loginBtn"
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <span id="loginBtnText">Login</span>
                </button>
            </form>
            <div id="loginError" class="mt-4 text-red-600 text-center hidden"></div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 bg-gray-800 text-white z-50">
            <div class="p-4 border-b border-gray-700">
                <h2 class="text-xl font-bold">Polyspack Admin</h2>
            </div>
            <nav class="mt-8">
                <a href="#" class="nav-link block px-4 py-3 hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-500" data-page="dashboard">
                    <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                </a>
                <a href="#" class="nav-link block px-4 py-3 hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-500" data-page="products">
                    <i class="fas fa-box mr-3"></i>Products
                </a>
                <a href="#" class="nav-link block px-4 py-3 hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-500" data-page="orders">
                    <i class="fas fa-shopping-cart mr-3"></i>Orders
                </a>
                <a href="#" class="nav-link block px-4 py-3 hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-500" data-page="users">
                    <i class="fas fa-users mr-3"></i>Users
                </a>
                <a href="#" class="nav-link block px-4 py-3 hover:bg-gray-700 border-l-4 border-transparent hover:border-blue-500" data-page="settings">
                    <i class="fas fa-cog mr-3"></i>Settings
                </a>
            </nav>
            <div class="absolute bottom-4 left-4 right-4">
                <button id="logoutBtn" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="main-content ml-64 p-8">
            <!-- Header -->
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h1 id="pageTitle" class="text-3xl font-bold text-gray-800">Dashboard</h1>
                    <p class="text-gray-600">Welcome back, Admin</p>
                </div>
                <button id="toggleSidebar" class="bg-gray-200 p-2 rounded-md hover:bg-gray-300 md:hidden">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <!-- Page Content -->
            <div id="pageContent" class="fade-in">
                <!-- Dashboard Content -->
                <div id="dashboardContent">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center">
                                <div class="p-3 bg-blue-100 rounded-full">
                                    <i class="fas fa-box text-blue-600 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-gray-600">Total Products</p>
                                    <p class="text-2xl font-bold" id="totalProducts">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center">
                                <div class="p-3 bg-green-100 rounded-full">
                                    <i class="fas fa-shopping-cart text-green-600 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-gray-600">Total Orders</p>
                                    <p class="text-2xl font-bold" id="totalOrders">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center">
                                <div class="p-3 bg-yellow-100 rounded-full">
                                    <i class="fas fa-users text-yellow-600 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-gray-600">Total Users</p>
                                    <p class="text-2xl font-bold" id="totalUsers">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center">
                                <div class="p-3 bg-purple-100 rounded-full">
                                    <i class="fas fa-dollar-sign text-purple-600 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-gray-600">Revenue</p>
                                    <p class="text-2xl font-bold" id="totalRevenue">$0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4">Recent Orders</h3>
                        <div id="recentOrders" class="space-y-4">
                            <p class="text-gray-500">Loading...</p>
                        </div>
                    </div>
                </div>

                <!-- Products Content -->
                <div id="productsContent" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Products Management</h2>
                        <button id="addProductBtn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>Add Product
                        </button>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div id="productsList" class="space-y-4">
                            <p class="text-gray-500">Loading products...</p>
                        </div>
                    </div>
                </div>

                <!-- Orders Content -->
                <div id="ordersContent" class="hidden">
                    <h2 class="text-2xl font-bold mb-6">Orders Management</h2>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div id="ordersList" class="space-y-4">
                            <p class="text-gray-500">Loading orders...</p>
                        </div>
                    </div>
                </div>

                <!-- Users Content -->
                <div id="usersContent" class="hidden">
                    <h2 class="text-2xl font-bold mb-6">Users Management</h2>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div id="usersList" class="space-y-4">
                            <p class="text-gray-500">Loading users...</p>
                        </div>
                    </div>
                </div>

                <!-- Settings Content -->
                <div id="settingsContent" class="hidden">
                    <h2 class="text-2xl font-bold mb-6">Settings</h2>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <p class="text-gray-500">Settings panel coming soon...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add/Edit Product Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 id="productModalTitle" class="text-xl font-bold">Add Product</h3>
                        <button id="closeProductModal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <form id="productForm" class="space-y-4">
                        <input type="hidden" id="productId">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                                <input type="text" id="productName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                                <select id="productCategory" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Category</option>
                                    <option value="Fertilizers">Fertilizers</option>
                                    <option value="Seeds">Seeds</option>
                                    <option value="Pesticides">Pesticides</option>
                                    <option value="Tools">Tools</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="productDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Price</label>
                                <input type="number" id="productPrice" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Stock</label>
                                <input type="number" id="productStock" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Image URL</label>
                                <input type="url" id="productImage" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="flex justify-end space-x-4">
                            <button type="button" id="cancelProductBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Cancel</button>
                            <button type="submit" id="saveProductBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                <span id="saveProductBtnText">Save Product</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_BASE = 'http://localhost:5000/api';

        // State management
        let currentUser = null;
        let currentPage = 'dashboard';

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');
        const navLinks = document.querySelectorAll('.nav-link');
        const pageContent = document.getElementById('pageContent');
        const pageTitle = document.getElementById('pageTitle');

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Login form
            loginForm.addEventListener('submit', handleLogin);

            // Logout
            logoutBtn.addEventListener('click', handleLogout);

            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = e.target.closest('.nav-link').dataset.page;
                    navigateToPage(page);
                });
            });

            // Product modal
            document.getElementById('addProductBtn').addEventListener('click', () => openProductModal());
            document.getElementById('closeProductModal').addEventListener('click', () => closeProductModal());
            document.getElementById('cancelProductBtn').addEventListener('click', () => closeProductModal());
            document.getElementById('productForm').addEventListener('submit', handleProductSubmit);
        }

        async function checkAuth() {
            const token = localStorage.getItem('adminToken');
            if (token) {
                currentUser = JSON.parse(localStorage.getItem('adminUser') || '{}');
                showDashboard();
                loadDashboardData();
            } else {
                showLogin();
            }
        }

        function showLogin() {
            loginPage.classList.remove('hidden');
            dashboard.classList.add('hidden');
        }

        function showDashboard() {
            loginPage.classList.add('hidden');
            dashboard.classList.remove('hidden');
        }

        async function handleLogin(e) {
            e.preventDefault();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginBtnText = document.getElementById('loginBtnText');

            loginBtn.disabled = true;
            loginBtnText.innerHTML = '<span class="loading"></span> Logging in...';

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password }),
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem('adminToken', data.token);
                    localStorage.setItem('adminUser', JSON.stringify(data.user));
                    currentUser = data.user;
                    showDashboard();
                    loadDashboardData();
                } else {
                    loginError.textContent = data.message || 'Login failed';
                    loginError.classList.remove('hidden');
                }
            } catch (error) {
                loginError.textContent = 'Network error. Please try again.';
                loginError.classList.remove('hidden');
            } finally {
                loginBtn.disabled = false;
                loginBtnText.textContent = 'Login';
            }
        }

        function handleLogout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminUser');
            currentUser = null;
            showLogin();
        }

        function navigateToPage(page) {
            currentPage = page;

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                products: 'Products Management',
                orders: 'Orders Management',
                users: 'Users Management',
                settings: 'Settings'
            };
            pageTitle.textContent = titles[page] || 'Dashboard';

            // Hide all content
            document.querySelectorAll('[id$="Content"]').forEach(content => {
                content.classList.add('hidden');
            });

            // Show selected content
            const contentId = `${page}Content`;
            const contentElement = document.getElementById(contentId);
            if (contentElement) {
                contentElement.classList.remove('hidden');
            }

            // Update navigation
            navLinks.forEach(link => {
                link.classList.remove('bg-gray-700', 'border-blue-500');
                link.classList.add('border-transparent');
            });
            document.querySelector(`[data-page="${page}"]`).classList.add('bg-gray-700', 'border-blue-500');
            document.querySelector(`[data-page="${page}"]`).classList.remove('border-transparent');

            // Load page data
            loadPageData(page);
        }

        async function loadDashboardData() {
            try {
                const [productsRes, ordersRes, usersRes] = await Promise.all([
                    fetch(`${API_BASE}/products`, { headers: getAuthHeaders() }),
                    fetch(`${API_BASE}/orders`, { headers: getAuthHeaders() }),
                    fetch(`${API_BASE}/admin/users`, { headers: getAuthHeaders() })
                ]);

                const products = productsRes.ok ? await productsRes.json() : [];
                const orders = ordersRes.ok ? await ordersRes.json() : [];
                const users = usersRes.ok ? await usersRes.json() : [];

                document.getElementById('totalProducts').textContent = products.length;
                document.getElementById('totalOrders').textContent = orders.length;
                document.getElementById('totalUsers').textContent = users.length;

                // Calculate revenue
                const revenue = orders.reduce((sum, order) => sum + (order.total || 0), 0);
                document.getElementById('totalRevenue').textContent = `$${revenue.toFixed(2)}`;

                // Show recent orders
                displayRecentOrders(orders.slice(0, 5));

            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        async function loadPageData(page) {
            switch (page) {
                case 'products':
                    await loadProducts();
                    break;
                case 'orders':
                    await loadOrders();
                    break;
                case 'users':
                    await loadUsers();
                    break;
            }
        }

        async function loadProducts() {
            try {
                const response = await fetch(`${API_BASE}/products`, { headers: getAuthHeaders() });
                const products = response.ok ? await response.json() : [];

                const productsList = document.getElementById('productsList');
                if (products.length === 0) {
                    productsList.innerHTML = '<p class="text-gray-500">No products found.</p>';
                    return;
                }

                productsList.innerHTML = products.map(product => `
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <img src="${product.image || '/placeholder-product.jpg'}" alt="${product.name}" class="w-12 h-12 object-cover rounded">
                            <div>
                                <h3 class="font-medium">${product.name}</h3>
                                <p class="text-sm text-gray-600">${product.category}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="font-medium">$${product.price}</span>
                            <span class="text-sm text-gray-600">Stock: ${product.stock}</span>
                            <button onclick="editProduct('${product._id}')" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteProduct('${product._id}')" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('productsList').innerHTML = '<p class="text-red-500">Error loading products.</p>';
            }
        }

        async function loadOrders() {
            try {
                const response = await fetch(`${API_BASE}/orders`, { headers: getAuthHeaders() });
                const orders = response.ok ? await response.json() : [];

                const ordersList = document.getElementById('ordersList');
                if (orders.length === 0) {
                    ordersList.innerHTML = '<p class="text-gray-500">No orders found.</p>';
                    return;
                }

                ordersList.innerHTML = orders.map(order => `
                    <div class="p-4 border border-gray-200 rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="font-medium">Order #${order._id.slice(-8)}</h3>
                                <p class="text-sm text-gray-600">${new Date(order.createdAt).toLocaleDateString()}</p>
                            </div>
                            <span class="px-2 py-1 text-xs rounded-full ${
                                order.status === 'completed' ? 'bg-green-100 text-green-800' :
                                order.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                'bg-gray-100 text-gray-800'
                            }">${order.status}</span>
                        </div>
                        <p class="text-sm text-gray-600">Customer: ${order.customerName || 'N/A'}</p>
                        <p class="font-medium">Total: $${order.total || 0}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading orders:', error);
                document.getElementById('ordersList').innerHTML = '<p class="text-red-500">Error loading orders.</p>';
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE}/admin/users`, { headers: getAuthHeaders() });
                const users = response.ok ? await response.json() : [];

                const usersList = document.getElementById('usersList');
                if (users.length === 0) {
                    usersList.innerHTML = '<p class="text-gray-500">No users found.</p>';
                    return;
                }

                usersList.innerHTML = users.map(user => `
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                        <div>
                            <h3 class="font-medium">${user.name}</h3>
                            <p class="text-sm text-gray-600">${user.email}</p>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full ${
                            user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'
                        }">${user.role}</span>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersList').innerHTML = '<p class="text-red-500">Error loading users.</p>';
            }
        }

        function displayRecentOrders(orders) {
            const recentOrders = document.getElementById('recentOrders');
            if (orders.length === 0) {
                recentOrders.innerHTML = '<p class="text-gray-500">No recent orders.</p>';
                return;
            }

            recentOrders.innerHTML = orders.map(order => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                    <div>
                        <p class="font-medium">Order #${order._id.slice(-8)}</p>
                        <p class="text-sm text-gray-600">${new Date(order.createdAt).toLocaleDateString()}</p>
                    </div>
                    <span class="font-medium">$${order.total || 0}</span>
                </div>
            `).join('');
        }

        function openProductModal(product = null) {
            const modal = document.getElementById('productModal');
            const form = document.getElementById('productForm');
            const title = document.getElementById('productModalTitle');

            if (product) {
                title.textContent = 'Edit Product';
                document.getElementById('productId').value = product._id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productImage').value = product.image || '';
            } else {
                title.textContent = 'Add Product';
                form.reset();
                document.getElementById('productId').value = '';
            }

            modal.classList.remove('hidden');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.add('hidden');
        }

        async function handleProductSubmit(e) {
            e.preventDefault();

            const productId = document.getElementById('productId').value;
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                image: document.getElementById('productImage').value,
            };

            const saveBtn = document.getElementById('saveProductBtn');
            const saveBtnText = document.getElementById('saveProductBtnText');
            saveBtn.disabled = true;
            saveBtnText.innerHTML = '<span class="loading"></span> Saving...';

            try {
                const url = productId ? `${API_BASE}/products/${productId}` : `${API_BASE}/products`;
                const method = productId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeaders()
                    },
                    body: JSON.stringify(productData),
                });

                if (response.ok) {
                    closeProductModal();
                    loadProducts();
                    loadDashboardData();
                } else {
                    alert('Error saving product');
                }
            } catch (error) {
                console.error('Error saving product:', error);
                alert('Error saving product');
            } finally {
                saveBtn.disabled = false;
                saveBtnText.textContent = productId ? 'Update Product' : 'Save Product';
            }
        }

        // Global functions for inline event handlers
        window.editProduct = function(id) {
            // Find product and open modal
            fetch(`${API_BASE}/products/${id}`, { headers: getAuthHeaders() })
                .then(res => res.json())
                .then(product => openProductModal(product))
                .catch(error => console.error('Error fetching product:', error));
        };

        window.deleteProduct = async function(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;

            try {
                const response = await fetch(`${API_BASE}/products/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });

                if (response.ok) {
                    loadProducts();
                    loadDashboardData();
                } else {
                    alert('Error deleting product');
                }
            } catch (error) {
                console.error('Error deleting product:', error);
                alert('Error deleting product');
            }
        };

        function getAuthHeaders() {
            const token = localStorage.getItem('adminToken');
            return token ? { 'Authorization': `Bearer ${token}` } : {};
        }

        // Initialize dashboard on load
        navigateToPage('dashboard');
    </script>
</body>
</html>
